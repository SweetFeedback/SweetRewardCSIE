<html>
    <haed>
        <link href="/static/css/style_quiz.css" rel="stylesheet">
        <!-- Le styles -->
        <link href="/static/css/bootstrap.css" rel="stylesheet">
        <link href="/static/css/style2.css" rel="stylesheet">

        <!--<link href="assets/css/docs.css" rel="stylesheet">-->
        <link href="/static/css/bootstrap-responsive.css" rel="stylesheet">
        <style type="text/css">
          #footer {
            height: 20px;
          }
          body {
            height:100%;
            background-color: #f1f1f1;
            background-image: url('/static/img/others/retina_dust.png');
            background-repeat:repeat repeat;
            font-size: 16px;     
            padding-top: 20px; /* 60px to make the container go all the way to the bottom of the topbar */
          }
          #wrap {
            min-height: 100%;
            height: auto !important;
            height: 100%;
            /* Negative indent footer by its height */
            margin: 0 auto -20px;
            /* Pad bottom by footer height */
            padding: 0 0 20px;
          }
        </style>
    </head>
    <body>
        <div id="wrap" style="margin-left:100px;margin-right:100px;">
        <div class="navbar">
          <div class="container">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">SweetFeedback</a>
            <div class="nav-collapse collapse">
              <ul class="nav navbar-nav">
                <li class="active"><a href="/">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
              </ul>
              <ul class="nav navbar-nav pull-right">
                <li><img src="/static/img/cmu-sv-logo.png"></li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </div>
        <div class="container">

        <h2>CMUSV Questionaire</h2>
        <p>Do the quesionnaire and get candies(if score higher than <span id="threshold"></span>).</p>
        <table class="question">
        </table>
        <div id="result">
            <div id="score">Your score is...<div id="score_num"></div><div id="comment"></div></div>
        </div>

        <div id="footer">
        <div class="container" style="max-width:600px;">
          <p class="text-muted credit" >Sweet Building Greeter is made by Louis Yu, Ken Liang, and Ted Selker</p>
        </div>

        <script src="/static/js/jquery.js"></script>
        <script src="/static/js/jquery-ui.min.js"></script>
        <script>
            function get_questions(question_num) {
                var choosen = Array(0);
                for(var i = 0; i < question_num; i++) {
                    while(1) {
                        var rand = Math.floor((Math.random()*9));
                        var shown = false;
                        for(var j = 0; j < choosen.length; j++) {
                            if(choosen[j] == rand) {
                                shown = true;
                                break;
                            }
                        }

                        if(!shown) {
                            choosen[choosen.length] = rand;
                            break;
                        }
                    }
                }

                var questions = new Array(0);
                for(var i = 0; i < question_num; i++) {
                    var rand = choosen[i];
                    var question = {};
                    var content = '';
                    var caption = '';
                    var option1 = '';
                    var option2 = '';
                    var option3 = '';
                    var option4 = '';
                    var answer = '';

                    if(rand == 0) {
                        content = 'In 2012, what anniversary did Carnegie Mellon Silicon Valley celebrate?';
                        caption = 'CMUSV is 10 years old!';
                        option1 = '5th anniversary';
                        option2 = '10th anniversary';
                        option3 = '15th anniversary';
                        option4 = '20th anniversary';
                        answer = 'b';
                    } else if(rand == 1) {
                        content = 'Who is the Director of the Silicon Valley campus?';
                        caption = 'Our director is Martin Griss. You get to meet him!';
                        option1 = 'Jared Cohon';
                        option2 = 'Mark Kamlet';
                        option3 = 'Martin Griss';
                        option4 = 'Jim Morris';
                        answer = 'c';
                    } else if(rand == 2) {
                        content = 'What is the unique Carnegie Mellon Silicon Valley teaching style?';
                        caption = 'Learning by doing makes you perfect!';
                        option1 = 'Lecture-based';
                        option2 = 'Learn-by-doing';
                        option3 = 'Remote classes';
                        option4 = 'Textbook-based';
                        answer = 'b';
                    } else if(rand == 3) {
                        content = 'What is the Carnegie Mellon University motto?';
                        caption = 'My heart is in the work.';
                        option1 = 'Knowledge is liberty.';
                        option2 = 'Reach within, shape the future.';
                        option3 = 'My heart is in the work.';
                        option4 = 'Think. Grow. Change.';
                        answer = 'c';
                    } else if(rand == 4) {
                        content = 'The CyLab Mobility Research Center was established to explore developments in ';
                        caption = 'Mobile computing and networks';
                        option1 = 'Mobile computing and networks';
                        option2 = 'Space travel';
                        option3 = 'Startups';
                        option4 = 'Public Transportation';
                        answer = 'a';
                    } else if(rand == 5) {
                        content = 'Carnegie Mellon Silicon Valley shares its campus with';
                        caption = 'National Aeronautics and Space Administration';
                        option1 = 'Google';
                        option2 = 'Microsoft';
                        option3 = 'U.S. Army';
                        option4 = 'NASA';
                        answer = 'd';
                    } else if(rand == 6) {
                        content = 'What is the Carnegie Mellon University mascot?';
                        caption = "He is cute,isn't he?";
                        option1 = 'Avalanche the Golden Bear';
                        option2 = 'Scotty the Scottie Dog';
                        option3 = 'Swoop the Red Hawk';
                        option4 = 'Thunder the Wolf';
                        answer = 'b';
                    } else if(rand == 7) {
                        content = 'How many students are currently enrolled at Carnegie Mellon Silicon Valley?';
                        caption = 'Roughly 180';
                        option1 = '~180';
                        option2 = '~250';
                        option3 = '~320';
                        option4 = '~380';
                        answer = 'a';
                    } else if(rand == 8) {
                        content = 'Which degree programs at CMUSV can also be taken part-time?';
                        caption = 'MS Software Enginnering and MS software Management';
                        option1 = 'MS Software Engineering';
                        option2 = 'MS Software Management';
                        option3 = 'Ph.D. in Electrical and Computer Engineering';
                        option4 = 'a & b';
                        answer = 'd';
                    }

                    question['content'] = content;
                    question['caption'] = caption;
                    question['option1'] = option1;
                    question['option2'] = option2;
                    question['option3'] = option3;
                    question['option4'] = option4;
                    question['answer'] = answer;

                    questions[i] = question;
                }

                return questions;

            }

            function gen_question_html(correct_answers) {
                var question_num = 3;
                var s = '';

                var questions = get_questions(question_num);

                for(var i = 0; i < question_num; i++) {
                    var question = questions[i];
                    correct_answers[i] = question['answer'];

                    s += '<tr id="q + ' + i.toString() + '">';
                    s += '<td class="quiz" colspan="4">';
                    s += '<h4>' + (i+1).toString() + '. ' + question['content'] + '</h4>';
                    s += '<div style="color:green" id="cap_' + (i+1).toString() +'" class="caption">' + question['caption'] + '</div>';
                    s += '</td>';
                    s += '<tr>';
                    s += '<td class="tf" question="' + i.toString() + '" val="a">' + question['option1'] + '</td>';
                    s += '<td class="tf" question="' + i.toString() + '" val="b">' + question['option2'] + '</td>';
                    s += '<td class="tf" question="' + i.toString() + '" val="c">' + question['option3'] + '</td>';
                    s += '<td class="tf" question="' + i.toString() + '" val="d">' + question['option4'] + '</td>';
                    s += '</tr>';
                    s += '</tr>';
                }

                return s;
            }

            $(function(){
                var correct_answers = new Array(0);
                var answered = ["0","0","0","0","0","0","0","0","0"];
                var correct = 0;
                var count = 0;
                var standard = 80;
                var comment = new Array("", "", "OK...","Good!","Great!", "Excellent!!");
                var question_done = 0;
                
                var count_down = 300;
                var counter = setInterval(timer, 1000);
                function timer(){
                    count_down = count_down - 1;
                    if (count_down <= 0){
                        clearInterval(counter);
                        location.reload();
                        return;
                    }
                }

                var question_str = gen_question_html(correct_answers);
                $(".question").append(question_str);


                $("#threshold").text(standard);
                $(".caption").hide(); 
                $(".tf").click(function() {
                    count_down = 300;
                    // get question number, 0 ~ 4
                    //q_num = ($("tr").index($(this).parent().parent()));
                    q_num = parseInt($(this).attr("question"));
                    // if not answered yet
                    if (answered[q_num] == 0) {

                        // get answer
                        ans = $(this).attr("val");

                        if (ans == correct_answers[q_num]) {
                            // if correct, red
                            $.get("./feedback_insert?application_id=9&feedback_type=saying&feedback_description=right answer");
                            $(this).animate({backgroundColor:"#CCFFCC"}, 1000);
                            correct++;
                            count++;
                        } 
                        else {
                            //not correct, blue
                            $.get("./feedback_insert?application_id=10&feedback_type=saying&feedback_description=wrong answer");
                            $(this).animate({backgroundColor:"#FF8F8F"}, 1000);
                            count++;
                        }

                        // show the caption for the question
                        $("#cap_"+ (q_num+1)).fadeIn();

                        answered[q_num] = 1;
                        score = (100*correct/correct_answers.length);
                        if(score >= standard && question_done == correct_answers.length-1){
                            $.get("./feedback_insert?application_id=9&feedback_type=positive&feedback_description=well done in questionaire");
                        }
                        $('#score_num').html(score.toFixed(1) + "%");
                        $('#comment').html(comment[Math.floor(correct/correct_answers.length*5)]);
                        question_done++;
                    }
                });
            });

        </script>
    </body>
</html>
